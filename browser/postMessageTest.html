<html>
<head>
    <script type="text/javascript" src="/node_modules/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="scripts/player.js"></script>
    <script type="text/javascript" src="scripts/player-run.js"></script>
</head>

<body style="width:800px;margin: 0 auto">
<h1>postMessage</h1>

<script src="http://vizor.io/scripts/embed.js" data-vizorurl="http://7944b517.ngrok.io/bryevo/postmsg-obj?autoplay=1" ></script>

VR Mode:<input id="toggle" type="checkbox" />

Positions: 1 <input id="pos1" name="pos" type="radio" value="0"/>
2<input id="pos2" name="pos" type="radio" value="1"/>
3 <input id="pos3" name="pos" type="radio" value="2"/>
4 <input id="pos4" name="pos" type="radio" value="3"/>
5 <input id="pos5" name="pos" type="radio" value="4"/>
6 <input id="pos6" name="pos" type="radio" value="5"/><br/>
<input id="reseto" type="button" value="reset origin"/>
<input type="button" id="orbitorigin" value="Origin Position"/> <br/>
<input type="button" id="loadtext" value="Load Object" /> <br/>
<br>
<pre id="log">
    </pre>

<script type = "text/javascript">
    var $toggle = $('#toggle');
    var $log = $('#log');
    var $position1 = $('#pos1');
    var $position2 = $('#pos2');
    var $position3 = $('#pos3');
    var $position4 = $('#pos4');
    var $position5 = $('#pos5');
    var $position6 = $('#pos6');
    var $origin = $('#orbitorigin');
    var $reseto = $('#reseto');
    var $loadtext = $('#loadtext');

    // the embed script will create an iframe but right now one isn't available
    // so we defer setting this until send()
    var $vizor = null;

    function log(message) {
//        debugger;
        $log.append(message + '<br>')
    }

    function send(message) {
        debugger;
        if (!$vizor) {
            $vizor = $('iframe').first()
        }
//        console.log(message.data);
        log('OUT: '+ JSON.stringify(message));
        $vizor[0].contentWindow.postMessage(message, '*')
    }
//
//    $(function(){//wakeup
//        var $myCheckbox = $("#toggle");
//        var myToggleStateVariable = {};
//
//        myToggleStateVariable = E2.app.player.getVariables("cameraToggle");
//
//    $myCheckbox.on('click', function(e) {
//        console.log(e.currentTarget.checked);
//        myToggleStateVariable.value = e.currentTarget.checked;
//        E2.app.player.setVariables([myToggleStateVariable]);
//    })
//
//    });
    $toggle.on('click', function(e) {
        send({
            command: 'setVariables',
            name: 'cameraToggle',
            value: e.currentTarget.checked
        })
        send({
            command: 'getVariables',
            name: 'cameraToggle'
        })
    });
    $position1.on('click', function(e) {
        send({
            command: 'setVariables',
            name: 'cameraIndex',
            value: e.currentTarget.value
        })
        send({
            command: 'getVariables',
            name: 'cameraIndex'
        })
    })
    $position2.on('click', function(e) {
        send({
            command: 'setVariables',
            name: 'cameraIndex',
            value: e.currentTarget.value
        })
        send({
            command: 'getVariables',
            name: 'cameraIndex'
        })
    })
    $position3.on('click', function(e) {
        send({
            command: 'setVariables',
            name: 'cameraIndex',
            value: e.currentTarget.value
        })
        send({
            command: 'getVariables',
            name: 'cameraIndex'
        })
    })
    $position4.on('click', function(e) {
        send({
            command: 'setVariables',
            name: 'cameraIndex',
            value: e.currentTarget.value
        })
        send({
            command: 'getVariables',
            name: 'cameraIndex'
        })
    })
    $position5.on('click', function(e) {
        send({
            command: 'setVariables',
            name: 'cameraIndex',
            value: e.currentTarget.value
        })
        send({
            command: 'getVariables',
            name: 'cameraIndex'
        })
    })
    $position6.on('click', function(e) {
        send({
            command: 'setVariables',
            name: 'cameraIndex',
            value: e.currentTarget.value
        })
        send({
            command: 'getVariables',
            name: 'cameraIndex'
        })
    });
    $reseto.on('click', function(e) {
        send({
            command: 'setVariables',
            name: 'resetorigin',
            value: true
        })
        send({
            command: 'getVariables',
            name: 'resetorigin'
        })
    });
    $origin.on('click', function() {
        send({
            command: 'getVariables',
            name: 'orb_origin'
        })

    });
    $loadtext.on('click', function(e) {
        send({
            command: 'setVariables',
            name: 'boxobj',
            value: "/data/bryevo/assets/scene/anotherone/business-card-box.obj"
        })
        send({
            command: 'getVariables',
            name: 'boxobj'
        })
        send({
            command: 'setVariables',
            name: 'boxmtl',
            value: "/data/bryevo/assets/scene/anotherone/business-card-box.mtl"
        })
        send({
            command: 'getVariables',
            name: 'boxmtl'
        })
    });
    window.addEventListener('message', function(e) {
        log('IN: ' + JSON.stringify(e.data))
    }, false)
</script>
</body>
</html>