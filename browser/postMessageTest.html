<html>
<head>
    <script type="text/javascript" src="assets/js/three.js"></script>
    <script type="text/javascript" src="assets/js/OBJLoader.js"></script>
    <script type="text/javascript" src="/node_modules/jquery/dist/jquery.min.js"></script>
</head>

<body style="width:800px;margin: 0 auto">
<h1>postMessage</h1>

<script src="http://vizor.io/scripts/embed.js" data-vizorurl="http://f91876de.ngrok.io/bryevo/test01-d?autoplay=1" ></script>

VR Mode:<input id="toggle" type="checkbox" />

Positions: 1 <input id="pos1" name="pos" type="radio" value="0"/>
2<input id="pos2" name="pos" type="radio" value="1"/>
3 <input id="pos3" name="pos" type="radio" value="2"/>
4 <input id="pos4" name="pos" type="radio" value="3"/>
5 <input id="pos5" name="pos" type="radio" value="4"/>
6 <input id="pos6" name="pos" type="radio" value="5"/><br/>
<input type="button" id="geo"</input>
<input type="button" id="orbitorigin" /> <br/>
<br>
    <pre id="log">
    </pre>

<script>
    var $log = $('#log');
    var $toggle = $('#toggle');
    var $position1 = $('#pos1');
    var $position2 = $('#pos2');
    var $position3 = $('#pos3');
    var $position4 = $('#pos4');
    var $position5 = $('#pos5');
    var $position6 = $('#pos6');
    var $geometry = $('#geo');
    var $origin = $('#orbitorigin');

    // the embed script will create an iframe but right now one isn't available
    // so we defer setting this until send()
    var $vizor = null;

    function log(message) {
//        debugger;
        $log.append(message + '<br>')
    }
    function send(message) {
        if (!$vizor) {
            $vizor = $('iframe').first()
        }
//        console.log(message.data);
        log('OUT: '+ JSON.stringify(message));
        $vizor[0].contentWindow.postMessage(message, '*')
    }
    $toggle.on('click', function(e) {
        console.log(e.currentTarget.checked);

        send({
            command: 'setVariable',
            name: 'cameraToggle',
            value: e.currentTarget.checked
        })
        send({
            command: 'getVariable',
            name: 'cameraToggle'
        })
    })
    $position1.on('click', function(e) {
        send({
            command: 'setVariable',
            name: 'cameraIndex',
            value: e.currentTarget.value
        })
        send({
            command: 'getVariable',
            name: 'cameraIndex'
        })
    })
    $position2.on('click', function(e) {
        send({
            command: 'setVariable',
            name: 'cameraIndex',
            value: e.currentTarget.value
        })
        send({
            command: 'getVariable',
            name: 'cameraIndex'
        })
    })
    $position3.on('click', function(e) {
        send({
            command: 'setVariable',
            name: 'cameraIndex',
            value: e.currentTarget.value
        })
        send({
            command: 'getVariable',
            name: 'cameraIndex'
        })
    })
    $position4.on('click', function(e) {
        send({
            command: 'setVariable',
            name: 'cameraIndex',
            value: e.currentTarget.value
        })
        send({
            command: 'getVariable',
            name: 'cameraIndex'
        })
    })
    $position5.on('click', function(e) {
        send({
            command: 'setVariable',
            name: 'cameraIndex',
            value: e.currentTarget.value
        })
        send({
            command: 'getVariable',
            name: 'cameraIndex'
        })
    })
    $position6.on('click', function(e) {
        send({
            command: 'setVariable',
            name: 'cameraIndex',
            value: e.currentTarget.value
        })
        send({
            command: 'getVariable',
            name: 'cameraIndex'
        })
    })
    $geometry.on('click', function (e){
        console.log(themesh);
        if (themesh !== 'undefined') {
            send({
                command: 'setVariable',
                name: 'obj_load',
                value: themesh
            })
            send({
                command: 'getVariable',
                name: 'obj_load'
            })
        }
        else
        {
            console.log("error");
        }
    });
    $origin.on('click', function(e) {
        send({
            command: 'setVariable',
            name: 'orb_origin',
            value: e.currentTarget.value
        })
        send({
            command: 'getVariable',
            name: 'orb_origin'
        })
    });
    window.addEventListener('message', function(e) {
        log('IN: ' + JSON.stringify(e.data))
    }, false)
</script>

<script>
    var boxTexture = new THREE.ImageUtils.loadTexture("assets/business-card-box.jpg",{},
            /* Success*/
            function () {
                console.log("Texture Loaded");
            },
            /* FAILURE */
            function (e) {
                console.error(e);
            });

    var boxMaterial = new THREE.MeshPhongMaterial({
        map: boxTexture,
        shininess: 40
    });

    var modelloader = new THREE.OBJLoader();
    modelloader.load('assets/business-card-box.obj', oldCompletionCallback = function (impObject) {
        var object = null;
        impObject.children.forEach(function (child) {
            if (child instanceof THREE.Mesh) {
                object = new THREE.Mesh(new THREE.Geometry().fromBufferGeometry(child.geometry), boxMaterial);
                //decalMesh.name = "impObject";
                //scene.add(decalMesh);

                //decalTargets.push(decalMesh);
            }
        });

        completionCallback(object);
    });
var themesh;
    var completionCallback = function (objects) {
        debugger;
        console.log(objects);
        themesh = objects;
    };
</script>
</body>
</html>